{% extends "base.html" %}
{% load static %}

{% block title %}Home{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
{% endblock %}


{% block nav_elements %}
<li class="nav-item">
	<a class="nav-link text-dark" href="#about">About Us</a>
</li>
<li class="nav-item">
	<a class="nav-link text-dark" href="#citta">Città</a>
</li>
<li class="nav-item">
	<a class="nav-link text-dark" href="#eventi">Eventi</a>
</li>
<li class="nav-item">
	<a class="nav-link text-dark" href="#FAQ">FAQ</a>
</li>
<li class="nav-item">
	<a class="nav-link text-dark" href="#contact">Contattaci</a>
</li>
{% if user.is_authenticated %}
<li class="nav-item dropdown ms-3">
	<a class="nav-link dropdown-toggle profile-btn px-3 py-1" href="#" id="navbarDropdown" role="button"
		data-bs-toggle="dropdown" aria-expanded="false">
		{{ user.first_name }} {{ user.last_name }}
	</a>
	<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
		<li><a class="dropdown-item" href="{% url 'profile' %}">Profile</a></li>
		<li><a class="dropdown-item" href="{% url 'preferences' %}">Preferences</a></li>
		<li><a class="dropdown-item" href="{% url 'accreditation' %}">Accreditation</a></li>
		<li><hr class="dropdown-divider"> </li>
		<li><a class="dropdown-item" href="{% url 'logout' %}">Logout</a></li>
	</ul>
</li>
{% else %}
<li class="nav-item ms-3">
	<a class="btn login-btn px-3 py-1" href="{% url 'login' %}">Log In</a>
</li>
{% endif %}
{% endblock %}


{% block content %}
<!-- Hero -->
<section class="position-relative" style="height: 100%;">
<img src="{% static 'imgs/hero.png' %}" style="object-fit: cover; width: 100%; height: 100vh;" alt="Mensa">
<div class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column justify-content-center align-items-center text-center text-white" style="background: rgba(0,0,0,0.35)">
	<h1 class="fw-bold home-title">Mensa Go</h1>
	<p class="home-subtitle">Il tuo nuovo modo di mangiare</p>
	{% if cities %}
		<a href="#citta" class="btn btn-dark btn-lg">Scopri le mense</a>
	{% endif %}
</div>
</section>

<!-- About -->
<section id="about">
	<!-- About FLEX 1 -->
		<div class=" about-flex container">
			<!-- ELEM 1 -->
			<div class="about-elem">
				<div class="about-elem-side">
					<div class="about-elem-img">
						<div class="bg-square-about-left" style=""></div>
						<img src="{% static 'imgs/about/cucinando.png' %}" class="about-img-left" alt="caffe">
					</div>
				</div>
				<div class="about-elem-side">
					<h2>Always amazing experience</h2>
					<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Molestias veritatis iste,
						consectetur, laborum libero a neque maximus. Porro rem illum quo nostrum quispiam
						superiores. Possimus facilis velin, voluptatibus!</p>
				</div>
			</div>
			<!-- ELEM 2 -->
			<div class="about-elem">
				<div class="about-elem-side">
					<h2>Always amazing experience</h2>
					<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Molestias veritatis iste,
						consectetur, laborum libero a neque maximus. Porro rem illum quo nostrum quispiam
						superiores. Possimus facilis velin, voluptatibus!</p>
				</div>
				<div class="about-elem-side">
					<div class="about-elem-img">
					<div class="bg-square-about-right"></div>
					<img src="{% static 'imgs/about/verdure2.png' %}"  class="about-img-right" alt="caffe">
					</div>
				</div>
			</div>
	</div>
	<!-- About FLEX 2 -->
	<div class=" about-flex container">
			<!-- ELEM 1 -->
			<div class="about-elem">
				<div class="about-elem-side">
					<div class="about-elem-img">
						<div class="bg-square-about-left"></div>
						<img src="{% static 'imgs/about/cucinando.png' %}" class="about-img-left" alt="caffe">
					</div>
				</div>
				<div class="about-elem-side">
					<h2>Always amazing experience</h2>
					<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Molestias veritatis iste,
						consectetur, laborum libero a neque maximus. Porro rem illum quo nostrum quispiam
						superiores. Possimus facilis velin, voluptatibus!</p>
				</div>
			</div>
			<!-- ELEM 2 -->
			<div class="about-elem">
				<div class="about-elem-side">
					<h2>Always amazing experience</h2>
					<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Molestias veritatis iste,
						consectetur, laborum libero a neque maximus. Porro rem illum quo nostrum quispiam
						superiores. Possimus facilis velin, voluptatibus!</p>
				</div>
				<div class="about-elem-side">
					<div class="about-elem-img">
					<div class="bg-square-about-right"></div>
					<img src="{% static 'imgs/about/verdure2.png' %}"  class="about-img-right" alt="caffe">
					</div>
				</div>
			</div>
	</div>
</section>

<!-- Banner -->
<section class="fixed-banner" style="background-image: url('{% static "imgs/about/campo2.png" %}');">
	<div class="banner-content">
		<h2 class="banner-title">Goditi i nostri prodotti naturali</h2>
		<p class="banner-subtitle">
			Selezioniamo i migliori ingredienti a km 0 che rispettono i più
			alti standard di sostenibilità.
		</p>
	</div>
</section>



<!-- Citta -->
<section id="citta" class="container py-5">
	<small class="text-primary text-uppercase">
		Siamo presenti in tutta Italia
	</small>
	<h2 class="fw-bold mt-2">Scopri le mense</h2>
	<div class="row gy-5 gx-5 mt-4">
		{% if cities %}
			{% for city in cities %}
				{% if city.mensa_set.exists %}
					<!-- Prima città in primo piano -->
					{% if forloop.first %} 
						<div class="col-12 city-col">
							<a href="{% url 'mensa_city' city_name=city.name %}" class="text-decoration-none">
								<div class="card border-0 h-100">
									<img src="{{ city.landscape.url }}" class="card-img first-city-mensa-img" alt="{{ city.name }}">
									<div class="card-img-overlay d-flex flex-column justify-content-center align-items-center" style="background: rgba(0,0,0,0.3)">
										<h5 class="card-title first-city-mensa-title">{{ city.name }}</h5>
										<span class="badge bg-light text-dark ms-3 mt-2">
											{{ city.mensa_set.count }} {% if city.mensa_set.count > 1 %} mense attive {% else %} mensa attiva {% endif %}
										</span>
									</div>
								</div>
							</a>
						</div>
					{% else %}
						<div class="col-md-6 city-col">
							<a href="{% url 'mensa_city' city_name=city.name %}" class="text-decoration-none">
								<div class="card border-0 h-100">
									<img src="{{ city.landscape.url }}" class="card-img city-mensa-img" alt="{{ city.name }}">
									<div class="card-img-overlay d-flex flex-column justify-content-center align-items-center" style="background: rgba(0,0,0,0.3)">
										<h5 class="card-title city-mensa-title">{{ city.name }}</h5>
										<span class="badge bg-light text-dark ms-3 mt-2">
											{{ city.mensa_set.count }} {% if city.mensa_set.count > 1 %} mense attive {% else %} mensa attiva {% endif %}
										</span>
									</div>
								</div>
							</a>
						</div>
					{% endif %}
				{% endif %}
			{% endfor %}
		{% else %}
		<div class="col-12 text-center">
			<p>Nessuna città disponibile al momento.</p>
		</div>
		{% endif %}
	</div>
</section>

<!-- Upcoming Events -->
<section class="container" id="eventi">
	<div class="d-flex justify-content-between align-items-center mb-4">
		<div>
		<h2 class="fw-bold mb-0">Prossimi Eventi</h2>
		</div>
	</div>

	{% if events %}
		<div id="eventsCarousel" class="carousel slide" data-bs-ride="carousel">
		<div class="carousel-inner">
			{% for event in events %}
			<div class="carousel-item {% if forloop.first %}active{% endif %}">
				<div class="card bg-dark text-white">
				<img src="{{ event.img.url }}" class="card-img" alt="{{ event.name }}" style="height: 400px; object-fit: cover;">
				<div class="card-img-overlay d-flex flex-column justify-content-end p-4" style="background: linear-gradient(to top, rgba(0,0,0,0.7), transparent)">
					<h4 class="card-title">{{ event.name }}</h4>
					<p class="card-text">Data: {{ event.date|date:"d F Y" }}</p>
				</div>
				</div>
			</div>
			{% endfor %}
		</div>
		
		<!-- Controlli del carosello -->
		<button class="carousel-control-prev" type="button" data-bs-target="#eventsCarousel" data-bs-slide="prev">
			<span class="carousel-control-prev-icon" aria-hidden="true"></span>
			<span class="visually-hidden">Precedente</span>
		</button>
		<button class="carousel-control-next" type="button" data-bs-target="#eventsCarousel" data-bs-slide="next">
			<span class="carousel-control-next-icon" aria-hidden="true"></span>
			<span class="visually-hidden">Successivo</span>
		</button>
		
		<!-- Indicatori del carosello -->
		<div class="carousel-indicators">
			{% for event in events %}
			<button type="button" data-bs-target="#eventsCarousel" data-bs-slide-to="{{ forloop.counter0 }}" {% if forloop.first %}class="active" aria-current="true"{% endif %} aria-label="Slide {{ forloop.counter }}"></button>
			{% endfor %}
		</div>
		</div>
	{% else %}
		<div class="alert alert-info mt-3">
		<p class="mb-0">Nessun evento in programma al momento.</p>
		</div>
	{% endif %}
</section>

<!-- FAQ -->
<section id="FAQ" class="py-5">
	<div class="container">
		<h2 class="fw-bold">F.A.Q.</h2>
		<p class="text-muted">Risposte alle domande più frequenti</p>
		<div class="accordion" id="faqAccordion">
		<div class="accordion-item">
			<h2 class="accordion-header" id="heading1">
			<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1">
				Come posso utilizzare MensaGO?
			</button>
			</h2>
			<div id="collapse1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
			<div class="accordion-body">
				Registrati con la tua email universitaria, seleziona la tua università e inizia subito a esplorare le mense disponibili nella tua città.
			</div>
			</div>
		</div>
		<div class="accordion-item">
			<h2 class="accordion-header" id="heading2">
			<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2">
				Come posso ricaricare il mio credito?
			</button>
			</h2>
			<div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
			<div class="accordion-body">
				Accedi alla sezione "Accreditation" dal tuo profilo per ricaricare il tuo credito utilizzando vari metodi di pagamento.
			</div>
			</div>
		</div>
		<div class="accordion-item">
			<h2 class="accordion-header" id="heading3">
			<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3">
				Posso vedere quali ingredienti contengono i piatti?
			</button>
			</h2>
			<div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
			<div class="accordion-body">
				Sì, ogni piatto ha una descrizione dettagliata degli ingredienti. Inoltre, puoi specificare le tue allergie nel profilo per ricevere avvisi personalizzati.
			</div>
			</div>
		</div>
		</div>
	</div>
</section> 
	
	<!-- Contact -->
<section id="contact" class="container py-5">
	<h2 class="fw-bold">Contattaci</h2>
	<p class="text-muted">Hai domande? Scrivici!</p>
	<form id="contactForm" class="row g-3 mt-3" method="POST" action="">
		{% csrf_token %}
		<div class="col-md-6">
		<label for="id_name" class="form-label">Nome</label>
		<input type="text" name="name" id="id_name" class="form-control" required>
		{% if form.name.errors %}
			<div class="text-danger">
			{{ form.name.errors }}
			</div>
		{% endif %}
		</div>
		<div class="col-md-6">
		<label for="id_email" class="form-label">Email</label>
		<input type="email" name="email" id="id_email" class="form-control" required>
		{% if form.email.errors %}
			<div class="text-danger">
			{{ form.email.errors }}
			</div>
		{% endif %}
		</div>
		<div class="col-12">
		<label for="id_message" class="form-label">Messaggio</label>
		<textarea name="message" id="id_message" class="form-control" rows="4" required></textarea>
		{% if form.message.errors %}
			<div class="text-danger">
			{{ form.message.errors }}
			</div>
		{% endif %}
		</div>
		<div class="col-12">
		<button type="submit" class="btn btn-dark">Invia messaggio</button>
		</div>
		<div id="formStatus" class="col-12 mt-2" style="display: none;"></div>
	</form>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/carousel.js' %}"></script>
<script src="{% static 'js/contact.js' %}"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
	const imgsLeft = document.querySelectorAll('.about-img-left');
	const imgsRight = document.querySelectorAll('.about-img-right');
	const bgLeft = document.querySelectorAll('.bg-square-about-left');
	const bgRight = document.querySelectorAll('.bg-square-about-right');

	const observer = new IntersectionObserver((entries) => {
		entries.forEach(entry => {
			if(entry.isIntersecting){
				entry.target.classList.add('in-view');
			}
		});
	}, { threshold: 0.6 });

	imgsLeft.forEach(img => observer.observe(img));
	imgsRight.forEach(img => observer.observe(img));
	bgLeft.forEach(bg => observer.observe(bg));
	bgRight.forEach(bg => observer.observe(bg));
});
</script>

{% endblock %}
